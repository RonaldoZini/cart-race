<!DOCTYPE html>
<html>

<head>
    <meta charset="uft-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Cart Race</title>
    <link rel="stylesheet" href="node_modules/jquery/dist/jquery.min.js">
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    <script>
        // $(document).ready(){
        //     
        // }
        $(function () {
            var host = location.origin.replace(/^http/, 'ws')
            var ws = new WebSocket(host);

            ws.onmessage = function (event) {
                var value = JSON.parse(event.data);
                var dDate = new Date().toLocaleString();
                var db = openDatabase('raceDB', '1.0', 'raceDB', 2 * 1024 * 1024);

                db.transaction(function (tx) {
                    if (value.toString().trim() == 'Azul') {
                        tx.executeSql("UPDATE Competidores SET data_ultima_volta = '" + dDate + "' WHERE id = '" + $('#hdnCompetidor1').val() + "'");
                    }
                    else {
                        tx.executeSql("UPDATE Competidores SET data_ultima_volta = '" + dDate + "' WHERE id = '" + $('#hdnCompetidor2').val() + "'");
                    }
                });
                window.setTimeout(() => {
                    atualizarDashboard();
                }, 1500);
            };
        })

        function atualizarDashboard() {

        }

        function cadastrar() {
            var db = openDatabase('raceDB', '1.0', 'raceDB', 2 * 1024 * 1024);
            db.transaction(function (tx) {
                $('#hdnCompetidor1').val(uuid());
                $('#hdnCompetidor2').val(uuid());
                tx.executeSql('CREATE TABLE IF NOT EXISTS Competidores (id unique, nome, data_ultima_volta, cor, tempo)');
                tx.executeSql("INSERT INTO Competidores (id, nome, data_ultima_volta, cor, tempo) VALUES ('" + $('#hdnCompetidor1').val() + "','" + $('#txtCompetidor1').val() + "', '','azul','')");
                tx.executeSql("INSERT INTO Competidores (id, nome, data_ultima_volta, cor, tempo) VALUES ('" + $('#hdnCompetidor2').val() + "','" + $('#txtCompetidor2').val() + "', '','verde','')");
            });

            $('#divCadastro').css('display', 'none');
            $('#divDashboard').css('display', 'block');
        }
        function uuid() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
    </script>
</head>

<body>
    <div id="divCadastro" class="container-fluid" style="display:block;">
        <div class="row" style="margin-top: 10%;">
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <form>
                    <div class="form-group">
                        <input type="email" class="form-control" id="txtCompetidor1" aria-describedby="inputHelp"
                            placeholder="Informe o nome do competidor 1">
                        <small id="inputHelp" class="form-text text-muted">Obs: Carrinho Azul</small>
                        <input id="hdnCompetidor1" type="hidden">
                    </div>
                    <div class="form-group">
                        <input type="email" class="form-control" id="txtCompetidor2" aria-describedby="inputHelp2"
                            placeholder="Informe o nome do competidor 2">
                        <small id="inputHelp" class="form-text text-muted">Obs: Carrinho Verde</small>
                        <input id="hdnCompetidor2" type="hidden">
                    </div>
                </form>
            </div>
            <div class="col-md-2"></div>
        </div>
        <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <button type="button" class="btn btn-primary" style="width: 100%"
                    onclick="cadastrar()">Confirmar</button>
            </div>
            <div class="col-md-2"></div>
        </div>
    </div>
    <div id="divDashboard" class="container-fluid p-0" style="display:none;">
        <div class="row-fluid">
            <div class="col-12 p-0">
                <div class="topo">
                    <img src="img/Bandeira.JPG" class="img-fluid" style="height: 4.8rem;">
                </div>
            </div>
        </div>
        <div class="cartoes m-3">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-6">
                        <div class="cartao">
                            <div class="row">
                                <div class="col">
                                    <div class="card">
                                        <div class="card-header">
                                            <strong>Daniel Sandrin</strong>
                                        </div>
                                        <div class="card-body">
                                            <div class="info">
                                                <p><strong>Volta Atual:</strong> 00:13</p>
                                                <p><strong>Carrinho:</strong> Vermelho</p>
                                                <p><strong>Volta mais rápida:</strong> 00:12</p>
                                                <div class="NVolta" style="text-align: end;">
                                                    <p><strong>Nº Volta: </strong>1</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="card">
                                        <div class="card-header">
                                            <strong>Ronaldo Zini</strong>
                                        </div>
                                        <div class="card-body">
                                            <div class="info">
                                                <p><strong>Volta Atual:</strong> 15:00</p>
                                                <p><strong>Carrinho:</strong> Azul</p>
                                                <p><strong>Volta mais rápida:</strong> 15:00</p>
                                                <div class="NVolta" style="text-align: end;">
                                                    <p><strong>Nº Volta: </strong>1</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="container-fluid">
                            <div class="racing" style="text-align: center;">
                                <img src="img/racing-1312447_960_720.png" class="img-fluid"
                                    style="height: 15rem !important;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="voltaRapida">
            <div class="row-fluid">
                <div class="col-12 p-0">
                    <img src="img/Screenshot_4.png" class="img-fluid" style="height: 4.8rem;">
                </div>
            </div>
        </div>
        <div class="voltarapidaCompetidor mb-5">
            <div class="container-fluid">
                <div class="row">
                    <div class="col">
                        <div class="melhorVolta mt-2" style="text-align: center; font-size: 1.5rem;
                        font-weight: bold;">
                            <p>Melhores Voltas</p>
                        </div>
                        <div class="card mt-2">
                            <div class="card-header">
                                <strong>Daniel Sandrin - Tempo da volta: 00:13</strong>
                            </div>
                        </div>
                        <div class="card mt-2">
                            <div class="card-header">
                                <strong>Daniel Sandrin - Tempo da volta: 00:13</strong>
                            </div>
                        </div>
                        <div class="card mt-2">
                            <div class="card-header">
                                <strong>Daniel Sandrin - Tempo da volta: 00:13</strong>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="trofeu mt-2" style="text-align: center;">
                            <div class="MelhorInventum" style=" font-size: 1.5rem;
                            font-weight: bold;">
                                <p>Top 3 Melhores da inventum</p>
                            </div>
                            <div class="card mt-2">
                                <div class="card-header">
                                    <strong>Daniel Sandrin - Tempo da volta: 00:13</strong>
                                </div>
                            </div>
                            <div class="card mt-2">
                                <div class="card-header">
                                    <strong>Daniel Sandrin - Tempo da volta: 00:13</strong>
                                </div>
                            </div>
                            <div class="card mt-2">
                                <div class="card-header">
                                    <strong>Daniel Sandrin - Tempo da volta: 00:13</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>